---
phase: 01-foundation-compliance
plan: 04
type: execute
wave: 4
depends_on: ["01-01", "01-03"]
files_modified:
  - .output/public/
  - .do/app.yaml
  - package.json
autonomous: false
user_setup:
  - service: digitalocean
    why: "Static site deployment hosting"
    env_vars:
      - name: DIGITALOCEAN_ACCESS_TOKEN
        source: "DigitalOcean Dashboard -> API -> Generate Token (read/write)"
    dashboard_config:
      - task: "Connect GitHub repository"
        location: "DigitalOcean Dashboard -> Apps -> Create App -> GitHub"
      - task: "Configure build settings"
        location: "App Platform -> Settings -> App Spec"
      - task: "Set custom domain"
        location: "App Platform -> Settings -> Domains"

must_haves:
  truths:
    - "Site can be built with npm run generate"
    - ".output/public/ directory contains index.html and _nuxt/ assets"
    - "DigitalOcean App Platform can be configured to build from GitHub"
    - "Custom domain can be configured with automatic HTTPS/SSL"
  artifacts:
    - path: ".do/app.yaml"
      provides: "DigitalOcean App Platform specification"
      contains: "build_command, output_dir"
    - path: ".output/public/index.html"
      provides: "Static site entry point"
      contains: "<html"
  key_links:
    - from: "GitHub repository"
      to: "DigitalOcean App Platform"
      via: "App spec configuration"
      pattern: "build_command.*generate"
    - from: "DigitalOcean App Platform"
      to: ".output/public/"
      via: "output_dir configuration"
      pattern: "output_dir.*output/public"
---

<objective>
Configure DigitalOcean App Platform deployment pipeline with GitHub integration for automatic deployments.

Purpose: The site needs to be deployed to a public URL for testing and production use. DigitalOcean App Platform provides static site hosting with automatic HTTPS/SSL and continuous deployment from GitHub.

Output: DigitalOcean App Platform configured to automatically deploy the site when changes are pushed to GitHub.
</objective>

<execution_context>
@/home/deck/.claude/get-shit-done/workflows/execute-plan.md
@/home/deck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-compliance/01-RESEARCH.md
@.planning/phases/01-foundation-compliance/01-01-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Create DigitalOcean App Platform specification</name>
  <files>
    .do/app.yaml
  </files>
  <action>
    Create .do/app.yaml with DigitalOcean App Platform configuration:

    ```yaml
    name: campaign-site
    region: nyc
    services:
      - name: web
        github:
          repo: YOUR_USERNAME/campaign-site
          branch: main
        run_command: npm run generate
        build_command: npm run generate
        output_dir: .output/public
        environment_slug: node-js
        envs:
          - key: NODE_VERSION
            value: "20"
        instance_size_slug: basic-xxs
        instance_count: 1
        routes:
          - route: /
        # Static site configuration
        source_dir: /
        dockerfile_path: ""
    ```

    Key configuration details:
    - `build_command: npm run generate` - Builds the static site
    - `output_dir: .output/public` - Where Nuxt outputs static files
    - `environment_slug: node-js` - Uses Node.js runtime
    - `instance_size_slug: basic-xxs` - Smallest size (sufficient for static site)

    NOTE: Update `YOUR_USERNAME/campaign-site` with actual GitHub repo path.

    Also add a deployment script to package.json:
    ```json
    "scripts": {
      "deploy": "npm run generate && doctl apps create --spec .do/app.yaml"
    }
    ```

    DO NOT commit the actual DigitalOcean token. Add .do/ to .gitignore if it contains sensitive files.
  </action>
  <verify>
    1. Check .do/app.yaml exists with build_command and output_dir
    2. Check build_command is "npm run generate"
    3. Check output_dir is ".output/public"
    4. Verify .gitignore does not exclude .do/app.yaml (it should be committed)
  </verify>
  <done>
    DigitalOcean App spec created with:
    - Build command: npm run generate
    - Output directory: .output/public
    - GitHub repo placeholder ready for update
    - Node.js 20 environment specified
    - Basic instance size for cost efficiency
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <what-built>DigitalOcean App Platform configuration file (.do/app.yaml)</what-built>
  <how-to-verify>
    To complete deployment setup, you need to:

    1. **Create GitHub Repository:**
       - Go to https://github.com/new
       - Create repository named "campaign-site"
       - Push current code to the repository

    2. **Get DigitalOcean Access Token:**
       - Log in to https://cloud.digitalocean.com
       - Go to API -> Generate New Token
       - Create token with "read/write" scope
       - Save the token (you'll need it for doctl)

    3. **Install doctl CLI** (if not installed):
       ```bash
       curl -sSL https://cli.digitalocean.com/install.sh | sh
       # or
       brew install doctl
       ```

    4. **Authenticate doctl:**
       ```bash
       doctl auth init
       # Paste your access token when prompted
       ```

    5. **Create the App** (wait until above steps complete):
       ```bash
       # Update .do/app.yaml with your GitHub username first
       # Then deploy:
       doctl apps create --spec .do/app.yaml
       ```

    6. **Configure Custom Domain** (optional, in DigitalOcean Dashboard):
       - Go to Apps -> Your App -> Settings -> Domains
       - Add your domain and follow DNS instructions
       - HTTPS/SSL is provisioned automatically
  </how-to-verify>
  <resume-signal>Type "deployed" when DigitalOcean App is created and accessible</resume-signal>
</task>

</tasks>

<verification>
1. Run `npm run generate` - verify .output/public/index.html exists
2. Check .do/app.yaml has correct build_command and output_dir
3. After user completes setup: Visit the DigitalOcean App URL and verify site loads
4. Check that HTTPS/SSL is enabled (automatic on DigitalOcean)
</verification>

<success_criteria>
- .do/app.yaml configuration file exists
- `npm run generate` produces static .output/public/ directory
- DigitalOcean App Platform is configured with GitHub integration
- Site is deployed and accessible via public URL
- HTTPS/SSL is enabled automatically
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-compliance/01-04-SUMMARY.md`
</output>
